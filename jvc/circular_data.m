f=zeros(300,1);f(3)=-200e-6;q=K(7:306,7:306)\f;q(1:6,1)
f=zeros(6,1);f(3)=-200e-6;khat2(7:12,7:12)\f
net=cho_load('circringpos1.m');[q,k]=cho_dc(net);figure(1);cho_display(net,q);q(lookup_coord(net,'anon26.n(2)','z'));
shownodes(net)
[K] = assemble_system(net, 'K', 1);size(K)
size(find((K==k)==0));
[khat]=matrixcondensation_2endnodecirc(k)

q50 =
     5.40184596352722e-023
     2.85865156851758e-023
    -2.78221479016514e-005
        -0.484305634980141
        -0.240529306045083
    -1.16881093885827e-018
q160 =
     5.40178996437901e-023
     2.85884954207822e-023
    -2.78225517657126e-005
        -0.484302775856076
        -0.240543161407829
    -1.16879758147102e-018

Q160 =
   (3,1)       -2.78225507329654e-005
   (4,1)           -0.484302749990774
   (5,1)            -0.24054315834917
Q50 =
   (3,1)       -2.78221479168732e-005
   (4,1)           -0.484305635285394
   (5,1)           -0.240529306133319    
    


n2 - no anchor
     1     2     3     4     5     6    13    14    15    16    17    18
    13    14    15    16    17    18    19    20    21    22    23    24
    19    20    21    22    23    24    25    26    27    28    29    30
    25    26    27    28    29    30    31    32    33    34    35    36
    31    32    33    34    35    36    37    38    39    40    41    42
    37    38    39    40    41    42    43    44    45    46    47    48
    :
    295   296   297   298   299   300   301   302   303   304   305   306
    301   302   303   304   305   306     7     8     9    10    11    12

n - anchor
     0     0     0     0     0     0     7     8     9    10    11    12
     7     8     9    10    11    12    13    14    15    16    17    18
    13    14    15    16    17    18    19    20    21    22    23    24
    19    20    21    22    23    24    25    26    27    28    29    30
    25    26    27    28    29    30    31    32    33    34    35    36
    31    32    33    34    35    36    37    38    39    40    41    42
    :
    289   290   291   292   293   294   295   296   297   298   299   300
    295   296   297   298   299   300     1     2     3     4     5     6
    
    
radius=100u
alpha=pi/4
w=10u
h=2u

khat [a1;b2]=>[node1;node2]
khat2 =[[  4517.21426513791          -9210.8501368846                         0
         -9210.85013696644          22938.9145390035                         0
                         0                         0          28.3649930185638
                         0                         0       0.00103991811314863
                         0                         0       0.00032591488981187
       -0.0766197505036672          0.11478091907619                         0
         -4517.21426515924          9210.85013688827                         0
          9210.85013696213         -22938.9145389778                         0
                         0                         0         -28.3649930204026
                         0                         0      0.000965789778268544
                         0                         0      0.000504876520886197
        0.0269840210741683        -0.135340711389756                         0],...
       [  					 0                         0       -0.0766197505094794
                         0                         0         0.114780919077979
        0.0010399181129559      0.000325914889839737                         0
     5.29462555928304e-008      1.0418563823388e-008                         0
     1.04185638233317e-008     2.16257983103961e-008                         0
                         0                         0     2.06302322778504e-006
                         0                         0        0.0766197505082827
                         0                         0        -0.114780919078312
       -0.0010399181130129     -0.000325914889839178                         0
      2.0587059368192e-008     1.26270990460601e-008                         0
      2.0039932518584e-008    -1.20799721959773e-008                         0
                         0                         0    -7.04399679435279e-009],...
        [-4517.21426509193          9210.85013693973                         0
          9210.85013697862         -22938.9145390996                         0
                         0                         0         -28.3649930201819
                         0                         0      -0.00103991811298622
                         0                         0        -0.000325914889843
        0.0766197505076275        -0.114780919078449                         0
          4517.21426513791         -9210.85013695806                         0
         -9210.85013686866          22938.9145390838                         0
                         0                         0          28.3649930162355
                         0                         0     -0.000965789778338166
                         0                         0      -0.00050487652086928
       -0.0269840210744974          0.13534071138411                         0],...
        [                0                         0        0.0269840210738798
                         0                         0        -0.135340711388516
      0.000965789778276037      0.000504876520880984                         0
     2.05870593681295e-008     2.00399325196979e-008                         0
     1.26270990461069e-008    -1.20799721959573e-008                         0
                         0                         0    -7.04399679498339e-009
                         0                         0       -0.0269840210743979
                         0                         0         0.135340711388828
     -0.000965789778265336     -0.000504876520853292                         0
     4.77045907738386e-008     1.56602286404434e-008                         0
     1.56602286396365e-008     2.68674631263677e-008                         0
                         0                         0     2.06302322777444e-006]];


khat3 = ...
[[     4517.2      -9210.9            0            0            0     -0.07662
      -9210.9        22939            0            0            0      0.11478
            0            0       28.365    0.0010399   0.00032591            0
            0            0    0.0010399  5.2946e-008  1.0419e-008            0
            0            0   0.00032591  1.0419e-008  2.1626e-008            0
     -0.07662      0.11478            0            0            0   2.063e-006
      -4517.2       9210.9            0            0            0      0.07662
       9210.9       -22939            0            0            0     -0.11478
            0            0      -28.365   -0.0010399  -0.00032591            0
            0            0   0.00096579  2.0587e-008  1.2627e-008            0
            0            0   0.00050488   2.004e-008  -1.208e-008            0
     0.026984     -0.13534            0            0            0  -7.044e-009 ],...
[     -4517.2       9210.9            0            0            0     0.026984
       9210.9       -22939            0            0            0     -0.13534
            0            0      -28.365   0.00096579   0.00050488            0
            0            0   -0.0010399  2.0587e-008   2.004e-008            0
            0            0  -0.00032591  1.2627e-008  -1.208e-008            0
      0.07662     -0.11478            0            0            0  -7.044e-009
       4517.2      -9210.9            0            0            0    -0.026984
      -9210.9        22939            0            0            0      0.13534
            0            0       28.365  -0.00096579  -0.00050488            0
            0            0  -0.00096579  4.7705e-008   1.566e-008            0
            0            0  -0.00050488   1.566e-008  2.6867e-008            0
    -0.026984      0.13534            0            0            0   2.063e-006 ]];


khat4 = ...
[ 4517.2      -9210.9            0            0            0     -0.07662	      -4517.2       9210.9            0            0            0     0.026984
 -9210.9        22939            0            0            0      0.11478	       9210.9       -22939            0            0            0     -0.13534
       0            0       28.365    0.0010399   0.00032591            0	            0            0      -28.365   0.00096579   0.00050488            0
       0            0    0.0010399  5.2946e-008  1.0419e-008            0	            0            0   -0.0010399  2.0587e-008   2.004e-008            0
       0            0   0.00032591  1.0419e-008  2.1626e-008            0	            0            0  -0.00032591  1.2627e-008  -1.208e-008            0
-0.07662      0.11478            0            0            0   2.063e-006	      0.07662     -0.11478            0            0            0  -7.044e-009
 -4517.2       9210.9            0            0            0      0.07662	       4517.2      -9210.9            0            0            0    -0.026984
  9210.9       -22939            0            0            0     -0.11478	      -9210.9        22939            0            0            0      0.13534
       0            0      -28.365   -0.0010399  -0.00032591            0	            0            0       28.365  -0.00096579  -0.00050488            0
       0            0   0.00096579  2.0587e-008  1.2627e-008            0	            0            0  -0.00096579  4.7705e-008   1.566e-008            0
       0            0   0.00050488   2.004e-008  -1.208e-008            0	            0            0  -0.00050488   1.566e-008  2.6867e-008            0
0.026984     -0.13534            0            0            0  -7.044e-009 	    -0.026984      0.13534            0            0            0   2.063e-006]; 


%net=cho_load('circringpos1.m');[q,k]=cho_dc(net);figure(1);cho_display(net,q);q(lookup_coord(net,'b','z'));q50=q(1:6,1)
%[Q,khat,fhat]=matrixcondensation_endnode(k,[0;0;-200e-6;0;0;0],0);Q50=Q
   
uses mumps.net
uses stdlib.net
res=50
finalangle=pi/4
subnet arc[n(0) n(res)] [radius=100u]
[
  for k=0:res-1
  [
    pos    *      [o n(k)] [x=cos(k*finalangle/res)*radius y=sin(k*finalangle/res)*radius]
    pos    *      [o n(k+1)] [x=cos((k+1)*finalangle/res)*radius y=sin((k+1)*finalangle/res)*radius]
    beam3d parent [n(k) n(k+1)] [w=10u]
  ]
]
anchor p1 [a] [l=5u w=5u]
f3d * [b] [oy=pi/2 F=200u]
arc p1 [a b] []

R=100e-6;C=cos(pi/4);R1C=R*(1-C);S=sin(pi/2);RS=R*S;
h93=-h(3,3) + -h(5,3)*R1C + -h(4,3)*RS
h94=-h(3,4) + -h(5,4)*R1C + -h(4,4)*RS

%%%%%%%%%%%%%%%%%%%%%%%%%%%
alpha=pi/2,w=10e-6,h=2e-6;E=165e9;R=100e-6;
khat=[[ ...
       1087.7      -991.37            0            0            0    -0.033208
      -991.37       1087.7            0            0            0     0.023578
            0            0       3.9704   0.00023785   0.00015919            0
            0            0   0.00023785  2.2352e-008  8.7779e-009            0
            0            0   0.00015919  8.7779e-009  1.4486e-008            0
    -0.033208     0.023578            0            0            0  1.4321e-006
      -1087.7       991.37            0            0            0     0.033208
       991.37      -1087.7            0            0            0    -0.023578
            0            0      -3.9704  -0.00023785  -0.00015919            0
            0            0   0.00015919  1.4328e-009  7.1408e-009            0
            0            0   0.00023785  1.5007e-008  1.4328e-009            0
     0.023578    -0.033208            0            0            0  -4.691e-007 ],
  [
      -1087.7       991.37            0            0            0     0.023578
       991.37      -1087.7            0            0            0    -0.033208
            0            0      -3.9704   0.00015919   0.00023785            0
            0            0  -0.00023785  1.4328e-009  1.5007e-008            0
            0            0  -0.00015919  7.1408e-009  1.4328e-009            0
     0.033208    -0.023578            0            0            0  -4.691e-007
       1087.7      -991.37            0            0            0    -0.023578
      -991.37       1087.7            0            0            0     0.033208
            0            0       3.9704  -0.00015919  -0.00023785            0
            0            0  -0.00015919  1.4486e-008  8.7779e-009            0
            0            0  -0.00023785  8.7779e-009  2.2352e-008            0
    -0.023578     0.033208            0            0            0  1.4321e-006 ]];

h104 = -h44 + h34*RS

%%%%%%%%%%%%%%%%%%%%%%%%%%%

alpha=pi

h = ... 
[[
        92.09  5.1296e-010            0            0            0   -0.0058607
  4.0018e-011       17.507            0            0            0   -0.0017507
            0            0      0.72005  3.9089e-005  7.2005e-005            0
            0            0  3.9089e-005  6.1387e-009  3.9089e-009            0
            0            0  7.2005e-005  3.9089e-009  1.1217e-008            0
   -0.0058607   -0.0017507            0            0            0   6.356e-007
       -92.09 -1.2551e-010            0            0            0    0.0058607
 -2.1367e-010      -17.507            0            0            0    0.0017507
            0            0     -0.72005 -3.9089e-005 -7.2005e-005            0
            0            0 -3.9089e-005 -6.1387e-009 -3.9089e-009            0
            0            0  7.2005e-005  3.9089e-009  3.1837e-009            0
    0.0058607   -0.0017507            0            0            0 -2.8546e-007 ],
[
       -92.09 -2.7967e-011            0            0            0    0.0058607
 -4.2857e-010      -17.507            0            0            0   -0.0017507
            0            0     -0.72005 -3.9089e-005  7.2005e-005            0
            0            0 -3.9089e-005 -6.1387e-009  3.9089e-009            0
            0            0 -7.2005e-005 -3.9089e-009  3.1837e-009            0
    0.0058607    0.0017507            0            0            0 -2.8546e-007
        92.09  1.6007e-010            0            0            0   -0.0058607
 -2.0736e-010       17.507            0            0            0    0.0017507
            0            0      0.72005  3.9089e-005 -7.2005e-005            0
            0            0  3.9089e-005  6.1387e-009 -3.9089e-009            0
            0            0 -7.2005e-005 -3.9089e-009  1.1217e-008            0
   -0.0058607    0.0017507            0            0            0   6.356e-007  ]];
   
h104 = -h44 
   
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

