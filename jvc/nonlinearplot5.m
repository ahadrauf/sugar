function nonlinearplot5
format compact
pml = 200e-6;
H = 2e-6;
W = 5e-6;
%F = 0.5 * 8.854e-12 * H*proofmasslength * V^2 / gap^2 ;
V = 15;
N = 20;
gap = 2e-6;
f = N * 0.5 * 8.854e-12 * H * V^2 / gap; %Comb
volume = pml * pml * H;
density = 2300;
m = density * volume;
L = 50e-6;
E = 165e9;
I = W^3*H/12;
k1 = 3*E*I/L^3;
viscosity = 1.78e-5; %viscosity of air
fluid = 2e-6; %Between the device and the substrate.
w0 = sqrt(k1/m); %1.1978e+005
c = viscosity*pml^2/fluid;
k3 = 3.26*E*I/L^5; %2.2412e+006
Amax = f/(c*w0)
c,f,k3,k1,m,w0

g = c/m/2; 
b = ((1e3*0+1)) *k3/m; 
F = f/m; 

g=0.2; b=0.2;F=4;f=F;w0=1;m=1;
for b=[2]
res=1000;
small = 0.1;
i1=0;i3=0;i5=0;W1=0;W3=0;W5=0;A1=0;A3=0;A5=0;i=0;P1=0;P3=0;P5=0;F1=0;F3=0;F5=0;
I=sqrt(-1);
lim=w0*4;
%for w=0:lim/res:lim
w=1.75;
for F=0:15/res:15
    a1=1/3*sqrt(2)*sqrt(b*(8*w0^6-24*w0^4*w^2+24*w0^2*w^4+288*g^2*w^2*w0^2-288*g^2*w^4-8*w^6+81*F^2*b+3*sqrt(3)*sqrt(48*w0^6*F^2*b+2048*w0^4*g^4*w^4-1024*w0^6*w^4*g^2+256*w0^8*g^2*w^2-144*w0^4*w^2*F^2*b+144*w0^2*w^4*F^2*b-1728*g^2*w^4*F^2*b+1728*g^2*w^2*w0^2*F^2*b+243*F^4*b^2+1536*w0^4*g^2*w^6-4096*w0^2*w^6*g^4-1024*w0^2*w^8*g^2-48*w^6*F^2*b+4096*g^6*w^6+2048*g^4*w^8+256*g^2*w^10))^(1/3)*(-48*g^2*w^2+(8*w0^6-24*w0^4*w^2+24*w0^2*w^4+288*g^2*w^2*w0^2-288*g^2*w^4-8*w^6+81*F^2*b+3*sqrt(3)*sqrt(48*w0^6*F^2*b+2048*w0^4*g^4*w^4-1024*w0^6*w^4*g^2+256*w0^8*g^2*w^2-144*w0^4*w^2*F^2*b+144*w0^2*w^4*F^2*b-1728*g^2*w^4*F^2*b+1728*g^2*w^2*w0^2*F^2*b+243*F^4*b^2+1536*w0^4*g^2*w^6-4096*w0^2*w^6*g^4-1024*w0^2*w^8*g^2-48*w^6*F^2*b+4096*g^6*w^6+2048*g^4*w^8+256*g^2*w^10))^(2/3)+4*w0^4-8*w0^2*w^2+4*w^4-4*(8*w0^6-24*w0^4*w^2+24*w0^2*w^4+288*g^2*w^2*w0^2-288*g^2*w^4-8*w^6+81*F^2*b+3*sqrt(3)*sqrt(48*w0^6*F^2*b+2048*w0^4*g^4*w^4-1024*w0^6*w^4*g^2+256*w0^8*g^2*w^2-144*w0^4*w^2*F^2*b+144*w0^2*w^4*F^2*b-1728*g^2*w^4*F^2*b+1728*g^2*w^2*w0^2*F^2*b+243*F^4*b^2+1536*w0^4*g^2*w^6-4096*w0^2*w^6*g^4-1024*w0^2*w^8*g^2-48*w^6*F^2*b+4096*g^6*w^6+2048*g^4*w^8+256*g^2*w^10))^(1/3)*w0^2+4*(8*w0^6-24*w0^4*w^2+24*w0^2*w^4+288*g^2*w^2*w0^2-288*g^2*w^4-8*w^6+81*F^2*b+3*sqrt(3)*sqrt(48*w0^6*F^2*b+2048*w0^4*g^4*w^4-1024*w0^6*w^4*g^2+256*w0^8*g^2*w^2-144*w0^4*w^2*F^2*b+144*w0^2*w^4*F^2*b-1728*g^2*w^4*F^2*b+1728*g^2*w^2*w0^2*F^2*b+243*F^4*b^2+1536*w0^4*g^2*w^6-4096*w0^2*w^6*g^4-1024*w0^2*w^8*g^2-48*w^6*F^2*b+4096*g^6*w^6+2048*g^4*w^8+256*g^2*w^10))^(1/3)*w^2))/(b*(8*w0^6-24*w0^4*w^2+24*w0^2*w^4+288*g^2*w^2*w0^2-288*g^2*w^4-8*w^6+81*F^2*b+3*sqrt(3)*sqrt(48*w0^6*F^2*b+2048*w0^4*g^4*w^4-1024*w0^6*w^4*g^2+256*w0^8*g^2*w^2-144*w0^4*w^2*F^2*b+144*w0^2*w^4*F^2*b-1728*g^2*w^4*F^2*b+1728*g^2*w^2*w0^2*F^2*b+243*F^4*b^2+1536*w0^4*g^2*w^6-4096*w0^2*w^6*g^4-1024*w0^2*w^8*g^2-48*w^6*F^2*b+4096*g^6*w^6+2048*g^4*w^8+256*g^2*w^10))^(1/3));
    if abs(imag(a1))<small
        i1=i1+1;
        W1(i1)=w;
        F1(i1)=F;
        A1(i1)=real(a1);
        P1(i1)=atan(2*g*w*a1/((w0^2-w^2)*a1+3/4*b*a1^3));
    end
    a3=1/3*sqrt(-b*(8*w0^6-24*w0^4*w^2+24*w0^2*w^4+288*g^2*w^2*w0^2-288*g^2*w^4-8*w^6+81*F^2*b+3*sqrt(3)*sqrt(48*w0^6*F^2*b+2048*w0^4*g^4*w^4-1024*w0^6*w^4*g^2+256*w0^8*g^2*w^2-144*w0^4*w^2*F^2*b+144*w0^2*w^4*F^2*b-1728*g^2*w^4*F^2*b+1728*g^2*w^2*w0^2*F^2*b+243*F^4*b^2+1536*w0^4*g^2*w^6-4096*w0^2*w^6*g^4-1024*w0^2*w^8*g^2-48*w^6*F^2*b+4096*g^6*w^6+2048*g^4*w^8+256*g^2*w^10))^(1/3)*((8*w0^6-24*w0^4*w^2+24*w0^2*w^4+288*g^2*w^2*w0^2-288*g^2*w^4-8*w^6+81*F^2*b+3*sqrt(3)*sqrt(48*w0^6*F^2*b+2048*w0^4*g^4*w^4-1024*w0^6*w^4*g^2+256*w0^8*g^2*w^2-144*w0^4*w^2*F^2*b+144*w0^2*w^4*F^2*b-1728*g^2*w^4*F^2*b+1728*g^2*w^2*w0^2*F^2*b+243*F^4*b^2+1536*w0^4*g^2*w^6-4096*w0^2*w^6*g^4-1024*w0^2*w^8*g^2-48*w^6*F^2*b+4096*g^6*w^6+2048*g^4*w^8+256*g^2*w^10))^(2/3)+4*w0^4-8*w0^2*w^2-48*g^2*w^2+4*w^4+8*(8*w0^6-24*w0^4*w^2+24*w0^2*w^4+288*g^2*w^2*w0^2-288*g^2*w^4-8*w^6+81*F^2*b+3*sqrt(3)*sqrt(48*w0^6*F^2*b+2048*w0^4*g^4*w^4-1024*w0^6*w^4*g^2+256*w0^8*g^2*w^2-144*w0^4*w^2*F^2*b+144*w0^2*w^4*F^2*b-1728*g^2*w^4*F^2*b+1728*g^2*w^2*w0^2*F^2*b+243*F^4*b^2+1536*w0^4*g^2*w^6-4096*w0^2*w^6*g^4-1024*w0^2*w^8*g^2-48*w^6*F^2*b+4096*g^6*w^6+2048*g^4*w^8+256*g^2*w^10))^(1/3)*w0^2-8*(8*w0^6-24*w0^4*w^2+24*w0^2*w^4+288*g^2*w^2*w0^2-288*g^2*w^4-8*w^6+81*F^2*b+3*sqrt(3)*sqrt(48*w0^6*F^2*b+2048*w0^4*g^4*w^4-1024*w0^6*w^4*g^2+256*w0^8*g^2*w^2-144*w0^4*w^2*F^2*b+144*w0^2*w^4*F^2*b-1728*g^2*w^4*F^2*b+1728*g^2*w^2*w0^2*F^2*b+243*F^4*b^2+1536*w0^4*g^2*w^6-4096*w0^2*w^6*g^4-1024*w0^2*w^8*g^2-48*w^6*F^2*b+4096*g^6*w^6+2048*g^4*w^8+256*g^2*w^10))^(1/3)*w^2-I*sqrt(3)*(8*w0^6-24*w0^4*w^2+24*w0^2*w^4+288*g^2*w^2*w0^2-288*g^2*w^4-8*w^6+81*F^2*b+3*sqrt(3)*sqrt(48*w0^6*F^2*b+2048*w0^4*g^4*w^4-1024*w0^6*w^4*g^2+256*w0^8*g^2*w^2-144*w0^4*w^2*F^2*b+144*w0^2*w^4*F^2*b-1728*g^2*w^4*F^2*b+1728*g^2*w^2*w0^2*F^2*b+243*F^4*b^2+1536*w0^4*g^2*w^6-4096*w0^2*w^6*g^4-1024*w0^2*w^8*g^2-48*w^6*F^2*b+4096*g^6*w^6+2048*g^4*w^8+256*g^2*w^10))^(2/3)+4*I*sqrt(3)*w0^4-8*I*sqrt(3)*w0^2*w^2-48*I*sqrt(3)*g^2*w^2+4*I*sqrt(3)*w^4))/(b*(8*w0^6-24*w0^4*w^2+24*w0^2*w^4+288*g^2*w^2*w0^2-288*g^2*w^4-8*w^6+81*F^2*b+3*sqrt(3)*sqrt(48*w0^6*F^2*b+2048*w0^4*g^4*w^4-1024*w0^6*w^4*g^2+256*w0^8*g^2*w^2-144*w0^4*w^2*F^2*b+144*w0^2*w^4*F^2*b-1728*g^2*w^4*F^2*b+1728*g^2*w^2*w0^2*F^2*b+243*F^4*b^2+1536*w0^4*g^2*w^6-4096*w0^2*w^6*g^4-1024*w0^2*w^8*g^2-48*w^6*F^2*b+4096*g^6*w^6+2048*g^4*w^8+256*g^2*w^10))^(1/3));
    if abs(imag(a3))<small
        i3=i3+1;
        W3(i3)=w;
        F3(i3)=F;
        A3(i3)=real(a3);
        P3(i3)=atan(2*g*w*a3/((w0^2-w^2)*a3+3/4*b*a3^3));
    end    
    a5=1/3*sqrt(b*(8*w0^6-24*w0^4*w^2+24*w0^2*w^4+288*g^2*w^2*w0^2-288*g^2*w^4-8*w^6+81*F^2*b+3*sqrt(3)*sqrt(48*w0^6*F^2*b+2048*w0^4*g^4*w^4-1024*w0^6*w^4*g^2+256*w0^8*g^2*w^2-144*w0^4*w^2*F^2*b+144*w0^2*w^4*F^2*b-1728*g^2*w^4*F^2*b+1728*g^2*w^2*w0^2*F^2*b+243*F^4*b^2+1536*w0^4*g^2*w^6-4096*w0^2*w^6*g^4-1024*w0^2*w^8*g^2-48*w^6*F^2*b+4096*g^6*w^6+2048*g^4*w^8+256*g^2*w^10))^(1/3)*(-(8*w0^6-24*w0^4*w^2+24*w0^2*w^4+288*g^2*w^2*w0^2-288*g^2*w^4-8*w^6+81*F^2*b+3*sqrt(3)*sqrt(48*w0^6*F^2*b+2048*w0^4*g^4*w^4-1024*w0^6*w^4*g^2+256*w0^8*g^2*w^2-144*w0^4*w^2*F^2*b+144*w0^2*w^4*F^2*b-1728*g^2*w^4*F^2*b+1728*g^2*w^2*w0^2*F^2*b+243*F^4*b^2+1536*w0^4*g^2*w^6-4096*w0^2*w^6*g^4-1024*w0^2*w^8*g^2-48*w^6*F^2*b+4096*g^6*w^6+2048*g^4*w^8+256*g^2*w^10))^(2/3)-4*w0^4+8*w0^2*w^2+48*g^2*w^2-4*w^4-8*(8*w0^6-24*w0^4*w^2+24*w0^2*w^4+288*g^2*w^2*w0^2-288*g^2*w^4-8*w^6+81*F^2*b+3*sqrt(3)*sqrt(48*w0^6*F^2*b+2048*w0^4*g^4*w^4-1024*w0^6*w^4*g^2+256*w0^8*g^2*w^2-144*w0^4*w^2*F^2*b+144*w0^2*w^4*F^2*b-1728*g^2*w^4*F^2*b+1728*g^2*w^2*w0^2*F^2*b+243*F^4*b^2+1536*w0^4*g^2*w^6-4096*w0^2*w^6*g^4-1024*w0^2*w^8*g^2-48*w^6*F^2*b+4096*g^6*w^6+2048*g^4*w^8+256*g^2*w^10))^(1/3)*w0^2+8*(8*w0^6-24*w0^4*w^2+24*w0^2*w^4+288*g^2*w^2*w0^2-288*g^2*w^4-8*w^6+81*F^2*b+3*sqrt(3)*sqrt(48*w0^6*F^2*b+2048*w0^4*g^4*w^4-1024*w0^6*w^4*g^2+256*w0^8*g^2*w^2-144*w0^4*w^2*F^2*b+144*w0^2*w^4*F^2*b-1728*g^2*w^4*F^2*b+1728*g^2*w^2*w0^2*F^2*b+243*F^4*b^2+1536*w0^4*g^2*w^6-4096*w0^2*w^6*g^4-1024*w0^2*w^8*g^2-48*w^6*F^2*b+4096*g^6*w^6+2048*g^4*w^8+256*g^2*w^10))^(1/3)*w^2-I*sqrt(3)*(8*w0^6-24*w0^4*w^2+24*w0^2*w^4+288*g^2*w^2*w0^2-288*g^2*w^4-8*w^6+81*F^2*b+3*sqrt(3)*sqrt(48*w0^6*F^2*b+2048*w0^4*g^4*w^4-1024*w0^6*w^4*g^2+256*w0^8*g^2*w^2-144*w0^4*w^2*F^2*b+144*w0^2*w^4*F^2*b-1728*g^2*w^4*F^2*b+1728*g^2*w^2*w0^2*F^2*b+243*F^4*b^2+1536*w0^4*g^2*w^6-4096*w0^2*w^6*g^4-1024*w0^2*w^8*g^2-48*w^6*F^2*b+4096*g^6*w^6+2048*g^4*w^8+256*g^2*w^10))^(2/3)+4*I*sqrt(3)*w0^4-8*I*sqrt(3)*w0^2*w^2-48*I*sqrt(3)*g^2*w^2+4*I*sqrt(3)*w^4))/(b*(8*w0^6-24*w0^4*w^2+24*w0^2*w^4+288*g^2*w^2*w0^2-288*g^2*w^4-8*w^6+81*F^2*b+3*sqrt(3)*sqrt(48*w0^6*F^2*b+2048*w0^4*g^4*w^4-1024*w0^6*w^4*g^2+256*w0^8*g^2*w^2-144*w0^4*w^2*F^2*b+144*w0^2*w^4*F^2*b-1728*g^2*w^4*F^2*b+1728*g^2*w^2*w0^2*F^2*b+243*F^4*b^2+1536*w0^4*g^2*w^6-4096*w0^2*w^6*g^4-1024*w0^2*w^8*g^2-48*w^6*F^2*b+4096*g^6*w^6+2048*g^4*w^8+256*g^2*w^10))^(1/3));
    if abs(imag(a5))<small
        i5=i5+1;
        F5(i5)=F;
        W5(i5)=w;
        A5(i5)=real(a5);
        P5(i5)=atan(2*g*w*a5/((w0^2-w^2)*a5+3/4*b*a5^3));
    end
    
    i=i+1;
    aa(i)= f / m / sqrt( (w0^2-w^2)^2 + 4*g^2*w^2 );
    ww(i)=w;
end
figure(1);plot(F1,A1,'b',F3,A3,'r',F5,A5,'g');grid on; hold on;
figure(3);plot(F1,A1,'b',F3,A3,'r',F5,A5,'g');grid on; hold on;
figure(2);plot(F1,P1,'b',F3,P3,'r',F5,P5,'g');grid on; hold on;
end

%figure(2);clf;plot(ww,aa);grid on;

