L12=100e-6;L13=100e-6;theta=pi/4;layerthickness=4e-6;YoungsModulus=165e9;;
x1=0;x2=100e-6;x3=100e-6;y1=0;y2=0;y3=120e-6;
X=[x1,x2,x3];Y=[y1,y2,y3];nu=0.3;t=4e-6;
z=t;
%tapered beam -----------------------------------------
L=(L12+L13)/2;h=L*sin(theta);b=layerthickness;E=YoungsModulus;
k=0;
k(1,1)=-2/5*E*b*h^3*(7*L^3-24*L^2+30*L-20)/(L^3);
k(1,2)=2/5*E*b*h^3*(-28*L^3+47*L^2+6*L^4-30*L+10)/(L^3);
k(1,3)=2/5*E*b*h^3*(7*L^3-24*L^2+30*L-20)/(L^3);
k(1,4)=-2/5*E*b*h^3*(5*L^3-17*L^2+20*L-10)/(L^2);
k(2,2)=-2/15*E*b*h^3*(330*L^3-128*L^4-428*L^2+20*L^5+255*L-60)/(L^3);
k(2,3)=-2/5*E*b*h^3*(-28*L^3+47*L^2+6*L^4-30*L+10)/(L^3);
k(2,4)=2/15*E*b*h^3*(-68*L^3+14*L^4+123*L^2-95*L+30)/(L^2);
k(3,3)=-2/5*E*b*h^3*(7*L^3-24*L^2+30*L-20)/(L^3);
k(3,4)=2/5*E*b*h^3*(5*L^3-17*L^2+20*L-10)/(L^2); 
k(4,4)=-2/15*E*b*h^3*(11*L^3-38*L^2+45*L-20)/L; 
k(2,1)=k(1,2);k(3,1)=k(1,3);k(4,1)=k(1,4);k(3,2)=k(2,3);k(4,2)=k(2,4);k(4,3)=k(3,4);
T(4,1)=k(4,1)/2;T(4,2)=k(4,2)/2;T(4,3)=k(4,3);T(4,4)=k(4,4);
T(4,1)=k(4,1);T(4,2)=k(4,2);T(4,3)=k(4,3);T(4,4)=k(4,4);

% fhy       yh
% mh   = k  rh
% foy       yo
% mo        ro

%panar forces --------------------------------------------
k=0;
for i=1:3
   for j=1:3
      x(i,j)=X(i)-X(j);
      y(i,j)=Y(i)-Y(j);
   end
end
A123=(x(3,2)*y(2,1)-x(2,1)*y(3,2))/2;
nu=0.3;
k(1,1)=y(3,2)^2;
k(2,1)=-nu*y(3,2)*x(3,2);	k(2,2)=x(3,2)^2;
k(3,1)=-y(3,2)*y(3,1);		k(3,2)=nu*x(3,2)*y(3,1);	k(3,3)=y(3,1)^2;
k(4,1)=nu*y(3,2)*x(3,1);	k(4,2)=-x(3,2)*x(3,1);		k(4,3)=-nu*y(3,1)*x(3,1);	k(4,4)=x(3,1)^2;
k(5,1)=y(3,2)*y(2,1);		k(5,2)=-nu*x(3,2)*y(2,1);	k(5,3)=-y(3,1)*y(2,1);		k(5,4)=nu*x(3,1)*y(2,1);	k(5,5)=y(2,1)^2;
k(6,1)=-nu*y(3,2)*x(2,1);	k(6,2)=x(3,2)*x(2,1);		k(6,3)=nu*y(3,1)*x(2,1);	k(6,4)=-x(3,1)*x(2,1);	k(6,5)=-nu*y(2,1)*x(2,1);	k(6,6)=x(2,1)^2;

for i=1:6
   for j=1:i
      k(j,i)=k(i,j);
   end
end

kn=E*t/(4*A123*(1-nu^2))*k;

k=0;
k(1,1)=x(3,2)^2;
k(2,1)=-x(3,2)*y(3,2);		k(2,2)=y(3,2)^2;
k(3,1)=-x(3,2)*x(3,1);		k(3,2)=y(3,2)*x(3,1);		k(3,3)=x(3,1)^2;
k(4,1)=x(3,2)*y(3,1);		k(4,2)=-y(3,2)*y(3,1);		k(4,3)=-x(3,1)*y(3,1);		k(4,4)=y(3,1)^2;
k(5,1)=x(3,2)*x(2,1);		k(5,2)=-y(3,2)*x(2,1);		k(5,3)=-x(3,1)*x(2,1);		k(5,4)=y(3,1)*x(2,1);		k(5,5)=x(2,1)^2;
k(6,1)=-x(3,2)*y(2,1);		k(6,2)=y(3,2)*y(2,1);		k(6,3)=x(3,1)*y(2,1);		k(6,4)=-y(3,1)*y(2,1);		k(6,5)=-x(2,1)*y(2,1);	k(6,6)=y(2,1)^2;
ks=E*t/(8*A123*(1+nu))*k;

P=kn+ks;

%bending --------------------------------------------------
k=0;
C=[1 0  0  0     0     0    0       0                 0
   0 0  1  0     0     0    0       0                 0
   0 -1 0  0     0     0    0       0                 0
   1 0  y2 0     0     y2^2 0       0                 y2^3
   0 0  1  0     0     2*y2 0       0                 3*y2^2
   0 -1 0  0     -y2   0    0       -y2^2             0
   1 x3 y3 x3^2  x3*y3 y3^2 x3^3    (x3*y3^2+x3^2*y3) y3^3
   0 0  1  0     x3    2*y3 0       (2*x3*y3+x3^2)    3*y3^2
   0 -1 0  -2*x3 -y3   0    -3*x3^2 -(y3^2+2*x3*y3)   0];
%D=-z* ...
% [0 0 0 2 0 0 6*x 2*y     0
%  0 0 0 0 0 2 0   2*x     6*y
%  0 0 0 0 2 0 0   4*(x+y) 0];

%DTXDdV=E*t^3/(12*(1-nu^2))* ...
%[0 0 0          0              0          0             0                                 0
% 0 0 0          0              0          0             0                                 0   
% 0 0 4          0              0          0             0                                 0
% 0 0 0          2*(1-nu)       0          0             0                                 0
% 0 0 4*nu       0              4          0             0                                 0
% 0 0 12*x       0              12*nu*x    36*x^2        0                                 0 
% 0 0 4*(nu*x+y) 4*(1-nu)*(x+y) 4*(x+nu*y) 12*x*(nu*x+y) (12-8*nu)*(x+y)^2-8*(1-nu)*x*y    0
% 0 0 12*nu*y    0              12*y       36*nu*x*y     12*(x+nu*y)*y                     36*y^2];

I00=1/2*x3*y2;
I10=1/6*x3^2*y2;
I20=1/12*x3^3*y2;
I01=1/6*x3*y2*(y2+y3);
I02=1/12*x3*y2*(y2^2+y2*y3+y3^2);
I11=1/24*x3^2*y2*(y2+2*y3);

intDTXDdV=E*t^3/(12*(1-nu^2))* ...
[0 0 0 0              0                  0              0              0                                                  0
 0 0 0 0              0                  0              0              0                                                  0   
 0 0 0 0              0                  0              0              0                                                  0   
 0 0 0 4*I00          0                  0              0              0                                                  0
 0 0 0 0              2*(1-nu)*I00       0              0              0                                                  0
 0 0 0 4*nu*I00       0                  4*I00          0              0                                                  0
 0 0 0 12*I10         0                  12*nu*I10      36*I20         0                                                  0  
 0 0 0 4*(nu*I10+I01) 4*(1-nu)*(I10+I01) 4*(I10+nu*I01) 12*(nu*I20+11) 12*I20+16*I11+12*I02-8*nu*I20-8*nu*I11-8*nu*I02    0
 0 0 0 12*nu*I01      0                  12*I01         36*nu*I11      12*(I11+nu*I02)                                    36*I02];
%(12-8*nu)*(x+y)^2-8*(1-nu)*x*y
%12*x^2+16*x*y+12*y^2-8*nu*x^2-8*nu*x*y-8*nu*y^2
%12*I20+16*I11+12*I02-8*nu*I20-8*nu*I11-8*nu*I02
B=inv(C)'*intDTXDdV*inv(C);

% ------------------------------------------------------------ 

%ktap => yh ozh y0 oz0

%                         oz0                  oz0                  oz0
%kpla => x1 y1                x2 y2                x3 y3
%kben =>       z1 ox1 oy1           z2 ox2 oy2           z3 ox3 oy3  


i=1;j=2;k=3;K1=[ ... 
P(i,1) P(i,2) 000000 000000 000000 000000   P(i,3) P(i,4) 000000 000000 000000 000000   P(i,5) P(i,6) 000000 000000 000000 000000 
P(j,1) P(j,2) 000000 000000 000000 000000   P(j,3) P(j,4) 000000 000000 000000 000000   P(j,5) P(j,6) 000000 000000 000000 000000 
000000 000000 B(i,1) B(i,2) B(i,3) 000000   000000 000000 B(i,4) B(i,5) B(i,6) 000000   000000 000000 B(i,7) B(i,8) B(i,9) 000000 
000000 000000 B(j,1) B(j,2) B(j,3) 000000   000000 000000 B(j,4) B(j,5) B(j,6) 000000   000000 000000 B(j,7) B(j,8) B(j,9) 000000 
000000 000000 B(k,1) B(k,2) B(k,3) 000000   000000 000000 B(k,4) B(k,5) B(k,6) 000000   000000 000000 B(k,7) B(k,8) B(k,9) 000000 
000000 T(4,3) 000000 000000 000000 T(4,4)   000000 T(4,1) 000000 000000 000000 T(4,2)   000000 T(4,1) 000000 000000 000000 T(4,2)];
i=3;j=4;k=5;m=6;K2=[ ... 
P(i,1) P(i,2) 000000 000000 000000 000000   P(i,3) P(i,4) 000000 000000 000000 000000   P(i,5) P(i,6) 000000 000000 000000 000000 
P(j,1) P(j,2) 000000 000000 000000 000000   P(j,3) P(j,4) 000000 000000 000000 000000   P(j,5) P(j,6) 000000 000000 000000 000000 
000000 000000 B(j,1) B(i,2) B(i,3) 000000   000000 000000 B(i,4) B(i,5) B(i,6) 000000   000000 000000 B(i,7) B(i,8) B(i,9) 000000 
000000 000000 B(k,1) B(j,2) B(j,3) 000000   000000 000000 B(j,4) B(j,5) B(j,6) 000000   000000 000000 B(j,7) B(j,8) B(j,9) 000000 
000000 000000 B(m,1) B(k,2) B(k,3) 000000   000000 000000 B(k,4) B(k,5) B(k,6) 000000   000000 000000 B(k,7) B(k,8) B(k,9) 000000 
000000 T(4,1) 000000 000000 000000 T(4,2)   000000 T(4,3) 000000 000000 000000 T(4,4)   000000 T(4,1) 000000 000000 000000 T(4,2)];
i=5;j=6;k=7;m=8;n=9;K3=[ ... 
P(i,1) P(i,2) 000000 000000 000000 000000   P(i,3) P(i,4) 000000 000000 000000 000000   P(i,5) P(i,6) 000000 000000 000000 000000 
P(j,1) P(j,2) 000000 000000 000000 000000   P(j,3) P(j,4) 000000 000000 000000 000000   P(j,5) P(j,6) 000000 000000 000000 000000 
000000 000000 B(k,1) B(i,2) B(i,3) 000000   000000 000000 B(i,4) B(i,5) B(i,6) 000000   000000 000000 B(i,7) B(i,8) B(i,9) 000000 
000000 000000 B(m,1) B(j,2) B(j,3) 000000   000000 000000 B(j,4) B(j,5) B(j,6) 000000   000000 000000 B(j,7) B(j,8) B(j,9) 000000 
000000 000000 B(n,1) B(k,2) B(k,3) 000000   000000 000000 B(k,4) B(k,5) B(k,6) 000000   000000 000000 B(k,7) B(k,8) B(k,9) 000000 
000000 T(4,1) 000000 000000 000000 T(4,2)   000000 T(4,1) 000000 000000 000000 T(4,2)   000000 T(4,3) 000000 000000 000000 T(4,4)];

K=[K1;K2;K3];
K









i=1;j=2;k=3;K1=[ ... 
P(i,1) P(i,2) 000000 000000 000000 000000   P(i,3) P(i,4) 000000 000000 000000 000000   P(i,5) P(i,6) 000000 000000 000000 000000 
P(j,1) P(j,2) 000000 000000 000000 000000   P(j,3) P(j,4) 000000 000000 000000 000000   P(j,5) P(j,6) 000000 000000 000000 000000 
000000 000000 B(i,1) B(i,2) B(i,3) 000000   000000 000000 B(i,4) B(i,5) B(i,6) 000000   000000 000000 B(i,7) B(i,8) B(i,9) 000000 
000000 000000 B(j,1) B(j,2) B(j,3) 000000   000000 000000 B(j,4) B(j,5) B(j,6) 000000   000000 000000 B(j,7) B(j,8) B(j,9) 000000 
000000 000000 B(k,1) B(k,2) B(k,3) 000000   000000 000000 B(k,4) B(k,5) B(k,6) 000000   000000 000000 B(k,7) B(k,8) B(k,9) 000000 
000000 T(4,3) 000000 000000 000000 T(4,4)   000000 T(4,1) 000000 000000 000000 T(4,2)   000000 T(4,1) 000000 000000 000000 T(4,2)];
i=3;j=4;k=5;m=6;K2=[ ... 
P(i,1) P(i,2) 000000 000000 000000 000000   P(i,3) P(i,4) 000000 000000 000000 000000   P(i,5) P(i,6) 000000 000000 000000 000000 
P(j,1) P(j,2) 000000 000000 000000 000000   P(j,3) P(j,4) 000000 000000 000000 000000   P(j,5) P(j,6) 000000 000000 000000 000000 
000000 000000 B(j,1) B(i,2) B(i,3) 000000   000000 000000 B(i,4) B(i,5) B(i,6) 000000   000000 000000 B(i,7) B(i,8) B(i,9) 000000 
000000 000000 B(k,1) B(j,2) B(j,3) 000000   000000 000000 B(j,4) B(j,5) B(j,6) 000000   000000 000000 B(j,7) B(j,8) B(j,9) 000000 
000000 000000 B(m,1) B(k,2) B(k,3) 000000   000000 000000 B(k,4) B(k,5) B(k,6) 000000   000000 000000 B(k,7) B(k,8) B(k,9) 000000 
000000 T(4,1) 000000 000000 000000 T(4,2)   000000 T(4,3) 000000 000000 000000 T(4,4)   000000 T(4,1) 000000 000000 000000 T(4,2)];
i=5;j=6;k=7;m=8;n=9;K3=[ ... 
P(i,1) P(i,2) 000000 000000 000000 000000   P(i,3) P(i,4) 000000 000000 000000 000000   P(i,5) P(i,6) 000000 000000 000000 000000 
P(j,1) P(j,2) 000000 000000 000000 000000   P(j,3) P(j,4) 000000 000000 000000 000000   P(j,5) P(j,6) 000000 000000 000000 000000 
000000 000000 B(k,1) B(i,2) B(i,3) 000000   000000 000000 B(i,4) B(i,5) B(i,6) 000000   000000 000000 B(i,7) B(i,8) B(i,9) 000000 
000000 000000 B(m,1) B(j,2) B(j,3) 000000   000000 000000 B(j,4) B(j,5) B(j,6) 000000   000000 000000 B(j,7) B(j,8) B(j,9) 000000 
000000 000000 B(n,1) B(k,2) B(k,3) 000000   000000 000000 B(k,4) B(k,5) B(k,6) 000000   000000 000000 B(k,7) B(k,8) B(k,9) 000000 
000000 T(4,1) 000000 000000 000000 T(4,2)   000000 T(4,1) 000000 000000 000000 T(4,2)   000000 T(4,3) 000000 000000 000000 T(4,4)];


K=[K1;K2;K3];
K(18,:)=[];
K(12,:)=[];
K(6,:)=[];
K(:,18)=[];K(:,12)=[];K(:,6)=[];
K